{% extends "base.html" %}

{% block title %}Profile Settings - Dashboard - CUR8tr{% endblock %}

{% block content %}
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<form id="profile-form" method="POST" enctype="multipart/form-data">
    {{ form.csrf_token }}

  <section class="profile-figma">
    <!-- Header -->
    <div class="profile-figma-header">
      <div class="profile-figma-title">
        PROFILE SETTINGS
      </div>
    </div>
    <!-- Main Row: Inputs (left) & Image Upload (right) -->
    <div class="profile-figma-main">
      <!-- Left: Inputs Column -->
      <div class="profile-figma-form">
        <!-- Profile Name -->
        <div class="profile-figma-row">
          <img src="{{ url_for('static', filename='svg/username.svg') }}" alt="Profile" class="profile-figma-icon">
          {{ form.name(class="profile-figma-input", placeholder="Profile Name") }}
        </div>
        <!-- Bio -->
        <div class="profile-figma-row profile-figma-bio-row">
          {{ form.bio(class="profile-figma-input", placeholder="Bio") }}
        </div>
        <!-- Country & City -->
        <div class="profile-figma-country-city-row">
          <div class="profile-figma-country-field">
            <img src="{{ url_for('static', filename='svg/globe-earth.svg') }}" alt="Country" class="profile-figma-icon">
            {{ form.country(class="profile-figma-input", placeholder="Country") }}
          </div>
          <div class="profile-figma-city-field">
            <img src="{{ url_for('static', filename='svg/globe-earth.svg') }}" alt="City" class="profile-figma-icon">
            {{ form.city(class="profile-figma-input", placeholder="City") }}
          </div>
        </div>
        <!-- Instagram Handle -->
        <div class="profile-figma-row">
          <img src="{{ url_for('static', filename='svg/instagram.svg') }}" alt="Instagram" class="profile-figma-icon">
          {{ form.instagram_handle(class="profile-figma-input", placeholder="Instagram Handle") }}
        </div>
        <!-- TikTok Handle -->
        <div class="profile-figma-row">
          <img src="{{ url_for('static', filename='svg/tiktok.svg') }}" alt="TikTok" class="profile-figma-icon">
          {{ form.tiktok_handle(class="profile-figma-input", placeholder="TikTok Handle") }}
        </div>
        <!-- Make Profile Public -->
        <div class="profile-figma-public-row">
          <label class="profile-figma-checkbox">
            {{ form.is_public(class="profile-figma-checkbox-input") }}
            <span class="profile-figma-checkmark"></span>
          </label>
          <span class="profile-figma-public-label">Make Profile Public</span>
        </div>
      </div>
      <!-- Right: Image Upload Box -->
      <div class="profile-figma-upload-col">
        <div class="profile-figma-upload-row">
          <img src="{{ url_for('static', filename='svg/image-upload.svg') }}" alt="Upload" class="profile-figma-upload-icon">
          <span class="profile-figma-upload-label">Upload Profile Image</span>
          <div class="profile-figma-upload-dropzone" id="dropzone">
            {{ form.profile_image(style="display: none;", id="file-input") }}
            <span id="drop-content">Drag & drop or click to upload</span>
            <div id="preview-area" style="display: none;">
              <img id="preview-image" class="profile-figma-upload-preview">
              <span id="preview-name" class="profile-figma-upload-preview-name"></span>
              <button type="button" id="remove-image" class="profile-figma-upload-remove">Remove</button>
            </div>
          </div>
          {% if profile and profile.profile_image %}
            <img src="{{ profile.profile_image }}" alt="Current profile image" class="profile-figma-current-image">
          {% endif %}
        </div>
      </div>
    </div>
    <!-- Action Buttons below upload box -->
    <div class="profile-figma-actions">
      <a href="{{ url_for('dashboard') }}" class="profile-figma-back-btn">
        <img src="{{ url_for('static', filename='svg/arrow-left.svg') }}" alt="Back" class="profile-figma-action-icon">
        <span class="profile-figma-btn-text">Go Back</span>
      </a>
      <button type="submit" class="profile-figma-save-btn">
        <img src="{{ url_for('static', filename='svg/floppy-disk.svg') }}" alt="Save" class="profile-figma-action-icon">
        <span class="profile-figma-btn-text">Save Profile</span>
      </button>
    </div>
  </section>
</form>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('file-input');
    const dropContent = document.getElementById('drop-content');
    const previewArea = document.getElementById('preview-area');
    const previewImage = document.getElementById('preview-image');
    const previewName = document.getElementById('preview-name');
    const removeButton = document.getElementById('remove-image');
    dropzone.addEventListener('click', function() { fileInput.click(); });
    dropzone.addEventListener('dragover', function(e) {
        e.preventDefault();
        dropzone.style.borderColor = 'var(--primary-purple)';
        dropzone.style.backgroundColor = 'rgba(168, 85, 247, 0.05)';
    });
    dropzone.addEventListener('dragleave', function(e) {
        e.preventDefault();
        dropzone.style.borderColor = 'var(--gray-300)';
        dropzone.style.backgroundColor = 'var(--gray-50)';
    });
    dropzone.addEventListener('drop', function(e) {
        e.preventDefault();
        dropzone.style.borderColor = 'var(--gray-300)';
        dropzone.style.backgroundColor = 'var(--gray-50)';
        const files = e.dataTransfer.files;
        if (files.length > 0) { handleFile(files[0]); }
    });
    fileInput.addEventListener('change', function(e) {
        if (e.target.files.length > 0) { handleFile(e.target.files[0]); }
    });
    removeButton.addEventListener('click', function(e) {
        e.stopPropagation();
        fileInput.value = '';
        dropContent.style.display = 'block';
        previewArea.style.display = 'none';
    });
    function handleFile(file) {
        const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif'];
        if (!allowedTypes.includes(file.type)) {
            alert('Please select a valid image file (JPG, PNG, GIF)');
            return;
        }
        if (file.size > 16 * 1024 * 1024) {
            alert('File size must be less than 16MB');
            return;
        }
        const dataTransfer = new DataTransfer();
        dataTransfer.items.add(file);
        fileInput.files = dataTransfer.files;
        const reader = new FileReader();
        reader.onload = function(e) {
            previewImage.src = e.target.result;
            previewName.textContent = file.name;
            dropContent.style.display = 'none';
            previewArea.style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}
<style>
/* Responsive profile page styles for all phone sizes */
.profile-figma {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 60px 100px;
  gap: 40px;
  background: #FDD4A4;
  border: 4px solid #000;
  box-shadow: 9px 12px 0 #000;
  border-radius: 30px;
  width: 900px;
  max-width: 98vw;
  margin: 0 auto;
  box-sizing: border-box;
}
.profile-figma-header {
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 10px;
}
.profile-figma-title {
  font-family: 'Barlow', sans-serif;
  font-weight: 800;
  font-size: 48px;
  line-height: 1.1;
  text-align: center;
  color: #2C2C2E;
  margin: 0;
}
.profile-figma-main {
  display: flex;
  flex-direction: row;
  gap: 40px;
  width: 100%;
  justify-content: center;
}
.profile-figma-form {
  display: flex;
  flex-direction: column;
  gap: 25px;
  width: 100%;
  max-width: 390px;
  margin-bottom: auto;
}
.profile-figma-row, .profile-figma-bio-row {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 10px;
  max-width: 193px;
  width: 100%;
  margin-bottom: 2px;
}

.profile-figma-upload-col {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  width: 320px;
  max-width: 98vw;
}
.profile-figma-upload-row {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  width: 100%;
}
.profile-figma-upload-dropzone {
  width: 100%;
  min-height: 120px;
  background: #FDF0F0;
  border: 4px dashed #000;
  border-radius: 30px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
  cursor: pointer;
  margin-bottom: 10px;
  box-sizing: border-box;
}
.profile-figma-upload-preview {
  width: 80px;
  height: 80px;
  border-radius: 20px;
  object-fit: cover;
  border: 2px solid #000;
}
.profile-figma-upload-preview-name {
  font-size: 14px;
  color: #222;
  margin-top: 4px;
}
.profile-figma-upload-remove {
  background: #ECBED9;
  border: 2px solid #000;
  border-radius: 20px;
  padding: 4px 12px;
  font-family: 'Barlow', sans-serif;
  font-weight: 700;
  font-size: 16px;
  color: #000;
  cursor: pointer;
  margin-top: 6px;
}
.profile-figma-current-image {
  width: 80px;
  height: 80px;
  border-radius: 20px;
  object-fit: cover;
  border: 2px solid #000;
  margin-top: 8px;
}
.profile-figma-actions {
  display: flex;
  flex-direction: row;
  gap: 20px;
  width: 100%;
  justify-content: center;
  margin-top: 30px;
}
.profile-figma-back-btn, .profile-figma-save-btn {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 8px;
  padding: 10px 30px;
  background: #DCE45F;
  border: 4px solid #000;
  box-shadow: 4px 6px 0 #000;
  border-radius: 110px;
  font-family: 'Barlow', sans-serif;
  font-weight: 800;
  font-size: 20px;
  color: #000;
  text-decoration: none;
  cursor: pointer;
  transition: background 0.2s;
}
.profile-figma-back-btn:hover, .profile-figma-save-btn:hover {
  background: #e6f7a7;
}
.profile-figma-btn-text {
  font-size: 18px;
  font-weight: 700;
}
@media (max-width: 1400px) {
  .profile-figma {
    width: 100% !important;
    padding: 8px 0 !important;
    gap: 10px !important;
    margin-left: auto !important;
    margin-right: auto !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
  }
  .profile-figma-title {
    font-size: 28px !important;
    line-height: 36px !important;
  }
  .profile-figma-form, .profile-figma-upload-col {
    width: 100% !important;
    margin-left: auto !important;
    margin-right: auto !important;
    box-sizing: border-box !important;
  }
  .profile-figma-input {
    font-size: 16px !important;
    height: 32px !important;
    padding: 0 6px !important;
  }
  .profile-figma-upload-preview, .profile-figma-current-image {
    width: 56px !important;
    height: 56px !important;
    border-radius: 12px !important;
  }
  .profile-figma-actions {
    flex-direction: column !important;
    gap: 8px !important;
    width: 100% !important;
    
    margin-left: auto !important;
    margin-right: auto !important;
  }
  .profile-figma-back-btn, .profile-figma-save-btn {
    font-size: 16px !important;
    border-radius: 40px !important;
    padding: 8px 0 !important;
    width: 100% !important;
    
  }
}
@media (max-width: 768px) {
  .profile-figma {
    width: 100% !important;
    padding: 8px 0 !important;
    gap: 10px !important;
    margin-left: auto !important;
    margin-right: auto !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
  }
  .profile-figma-title {
    font-size: 28px !important;
    line-height: 36px !important;
  }
  .profile-figma-form, .profile-figma-upload-col {
    width: 100% !important;
    margin-left: auto !important;
    margin-right: auto !important;
    box-sizing: border-box !important;
  }
  .profile-figma-input {
    width: calc(100% - 36px); /* ensures input doesn't overlap icon */
    display: inline-block;
    vertical-align: middle;
  }
  .profile-figma-upload-preview, .profile-figma-current-image {
    width: 56px !important;
    height: 56px !important;
    border-radius: 12px !important;
  }
  .profile-figma-actions {
    flex-direction: column !important;
    gap: 8px !important;
    width: 100% !important;
    
    margin-left: auto !important;
    margin-right: auto !important;
  }
  .profile-figma-back-btn, .profile-figma-save-btn {
    font-size: 16px !important;
    border-radius: 40px !important;
    padding: 8px 0 !important;
    width: 100% !important;
    
  }
}
@media (max-width: 390px) {
  .profile-figma {
    width: 100% !important;
    padding: 8px 0 !important;
    gap: 10px !important;
    margin-left: auto !important;
    margin-right: auto !important;
    box-sizing: border-box !important;
    overflow-x: hidden !important;
  }
  .profile-figma-title {
    font-size: 28px !important;
    line-height: 36px !important;
  }
  .profile-figma-form, .profile-figma-upload-col {
    width: 100% !important;
    margin-left: auto !important;
    margin-right: auto !important;
    box-sizing: border-box !important;
  }
  .profile-figma-input {
    font-size: 16px !important;
    height: 32px !important;
    padding: 0 4px !important;
    
    width: 100% !important;
    min-width: 0 !important;
    border: none !important;
    background: transparent !important;
    box-sizing: border-box !important;
  }
  .profile-figma-upload-preview, .profile-figma-current-image {
    width: 56px !important;
    height: 56px !important;
    border-radius: 12px !important;
  }
  .profile-figma-actions {
    flex-direction: column !important;
    gap: 8px !important;
    width: 100% !important;
    
    margin-left: auto !important;
    margin-right: auto !important;
  }
  .profile-figma-back-btn, .profile-figma-save-btn {
    font-size: 16px !important;
    border-radius: 40px !important;
    padding: 8px 0 !important;
    width: 100% !important;
    
  }
}
</style>