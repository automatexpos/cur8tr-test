{% extends "base.html" %}

{% block title %}{{ profile.name }} - CUR8tr{% endblock %}

{% block content %}
<!-- Frame 8 Container -->
<div class="frame8-profile-container">

<div class="frame29-profile-header" style="display: flex; align-items: center;">
    <div class="frame29-profile-image-wrap">
        {% if profile.profile_image %}
            <img src="{{ profile.profile_image }}" 
                alt="{{ profile.name }}" 
                class="frame29-profile-image">
        {% else %}
            <div class="frame29-profile-avatar">
                {{ profile.name[0] }}
            </div>
        {% endif %}
    </div>
    <div class="frame29-profile-info">
        <h1 class="frame29-profile-name">{{ profile.name }}</h1>
        <div class="frame29-profile-member">
            <i class="fas fa-calendar"></i> Member since {{ profile.created_at.strftime('%B %Y') }}
        </div>
    </div>
        <div style="display: flex; flex-direction: row; gap: 16px; width: 100%; flex-wrap: wrap;">
                        <a href="javascript:void(0);"
                                 onclick="shareProfile('{{ profile.name }}', '{{ url_for('view_profile', slug=profile.slug, _external=True) }}', '{{ profile.bio[:100] if profile.bio else '' }}')"
                                 class="frame29-share-btn-responsive"
                                 style="
                                        display: flex;
                                        flex-direction: row;
                                        justify-content: center;
                                        align-items: center;
                                        padding: 10px 30px;
                                        gap: 10px;
                                        width: 309px;
                                        height: 56px;
                                        background: #B5B0D8;
                                        border: 4px solid #000000;
                                        box-shadow: 4px 6px 0px #000000;
                                        border-radius: 110px;
                                        color: #2C2C2E;
                                        font-size: 1rem;
                                        font-family: 'Barlow', sans-serif;
                                        font-weight: 700;
                                        cursor: pointer;
                                        white-space: nowrap;
                                        outline: none;
                                        box-sizing: border-box;
                                        text-decoration: none;
                                        min-width: 0;
                                        transition: background 0.2s, transform 0.2s;
                                        margin-left: auto;
                                 "
                                 onmouseover="this.style.background='#B3E0DD';this.style.transform='translateY(-2px)'"
                                 onmouseout="this.style.background='#B5B0D8';this.style.transform='none'">
                                        <img src="{{ url_for('static', filename='svg/arrow_right.svg') }}" alt="Share" style="width:20px;height:20px;vertical-align:middle;">
                                        Share Profile
                        </a>
                        {% if session.user_id and session.user_id != profile.user_id %}
                            <div class="frame29-profile-follow" style="margin:0;">
                                {% set current_user = get_current_user() %}
                                {% if current_user and current_user.is_following(profile.user) %}
                                    <form method="POST" action="{{ url_for('unfollow_user', user_id=profile.user_id) }}" style="margin: 0;">
                                        <button type="submit"
                                                        class="frame29-share-btn-responsive"
                                                        style="display: flex; flex-direction: row; justify-content: center; align-items: center; padding: 10px 30px; gap: 10px; width: 309px; height: 56px; background: #B5B0D8; border: 4px solid #000000; box-shadow: 4px 6px 0px #000000; border-radius: 110px; color: #2C2C2E; font-size: 1rem; font-family: 'Barlow', sans-serif; font-weight: 700; cursor: pointer; white-space: nowrap; outline: none; box-sizing: border-box; text-decoration: none; min-width: 0; transition: background 0.2s, transform 0.2s; margin-left: auto;"
                                                        onmouseover="this.style.background='#B3E0DD';this.style.transform='translateY(-2px)'"
                                                        onmouseout="this.style.background='#B5B0D8';this.style.transform='none'">
                                            <i class="fas fa-user-minus" style="margin-right:8px;"></i> Unfollow
                                        </button>
                                    </form>
                                {% else %}
                                    <form method="POST" action="{{ url_for('follow_user', user_id=profile.user_id) }}" style="margin: 0;">
                                        <button type="submit"
                                                        class="frame29-share-btn-responsive"
                                                        style="display: flex; flex-direction: row; justify-content: center; align-items: center; padding: 10px 30px; gap: 10px; width: 309px; height: 56px; background: #B5B0D8; border: 4px solid #000000; box-shadow: 4px 6px 0px #000000; border-radius: 110px; color: #2C2C2E; font-size: 1rem; font-family: 'Barlow', sans-serif; font-weight: 700; cursor: pointer; white-space: nowrap; outline: none; box-sizing: border-box; text-decoration: none; min-width: 0; transition: background 0.2s, transform 0.2s; margin-left: auto;"
                                                        onmouseover="this.style.background='#B3E0DD';this.style.transform='translateY(-2px)'"
                                                        onmouseout="this.style.background='#B5B0D8';this.style.transform='none'">
                                            <i class="fas fa-user-plus" style="margin-right:8px;"></i> Follow
                                        </button>
                                    </form>
                                {% endif %}
                            </div>
                        {% endif %}
        </div>
        <style>
        @media (max-width: 600px) {
            .frame29-share-btn-responsive {
                width: 100% !important;
                min-width: 0 !important;
                font-size: 0.95rem !important;
                padding: 10px 0 !important;
                height: auto !important;
                border-radius: 60px !important;
                justify-content: center !important;
                margin-left: 0 !important;
            }
            .frame29-profile-header {
                flex-direction: column !important;
                align-items: stretch !important;
            }
            .frame29-share-btn-responsive + form {
                width: 100% !important;
            }
        }
        </style>
</div>
        <!-- {% if session.user_id and session.user_id != profile.user_id %}
            <div class="frame29-profile-follow">
                {% set current_user = get_current_user() %}
                {% if current_user and current_user.is_following(profile.user) %}
                    <form method="POST" action="{{ url_for('unfollow_user', user_id=profile.user_id) }}">
                        <button type="submit" class="frame29-aa-unfollow">
                            <i class="fas fa-user-minus"></i> Unfollow
                        </button>
                    </form>
                {% else %}
                    <form method="POST" action="{{ url_for('follow_user', user_id=profile.user_id) }}">
                        <button type="submit" class="frame29-aa-follow">
                            <i class="fas fa-user-plus"></i> Follow
                        </button>
                    </form>
                {% endif %}
            </div>
        {% endif %} -->
    </div>

    <!-- Frame 47 Remaining Content -->
    {% set svg_map = {
    'Apps': 'apps.svg',
    'Books': 'books.svg',
    'Food': 'food.svg',
    'Products': 'products.svg',
    'Where To Stay': 'stay.svg',
    'YouTube Channels': 'youtube.svg'
} %}
<div class="frame47-profile-content">
    {% if categories %}
        <div class="frame39-profile-categories-row">
            {% for category in categories %}
                <div class="frame33-profile-category-card">
                    <div class="frame33-profile-category-title">
                        <img src="{{ url_for('static', filename='svg/' ~ svg_map.get(category.name, 'default.svg')) }}" alt="{{ category.name }} icon" class="frame33-category-svg">
                        {{ category.name }}
                    </div>
                    {% if category.description %}
                        <div class="frame33-profile-category-desc">{{ category.description }}</div>
                    {% endif %}
                    {% set recent_recs = category.recommendations[:3] %}
                    {% if recent_recs %}
                        <div>
                            {% for rec in recent_recs %}
                                <div class="frame47-profile-recommendation-item">
                                    {% if rec.image %}
                                        <!-- <img src="{{ rec.image }}" alt="{{ rec.title }}" class="frame47-profile-recommendation-image"> -->
                                    {% endif %}
                                    <div class="frame47-profile-recommendation-content">
                                        <a href="{{ url_for('view_recommendation', profile_slug=profile.slug, category_slug=category.slug, rec_id=rec.id) }}" class="frame47-profile-recommendation-title">
                                            {{ rec.title }}
                                        </a>
                                        <div class="frame47-profile-recommendation-meta">
                                            {% if rec.rating %}
                                                <span>
                                                    {% for i in range(rec.rating) %}
                                                        <img src="{{ url_for('static', filename='svg/star.svg') }}" alt="Star" class="rec-star-svg">
                                                    {% endfor %}
                                                    {% for i in range(5 - rec.rating) %}
                                                        <img src="{{ url_for('static', filename='svg/star_empty.svg') }}" alt="Star" class="rec-star-svg">
                                                    {% endfor %}
                                                    <span class="frame47-profile-recommendation-rating-value">({{ rec.rating }}/5)</span>
                                                </span>
                                            {% endif %}
                                            {% if rec.cost_rating %}
                                                <span class="frame47-profile-recommendation-cost">{{ rec.cost_rating }}</span>
                                            {% endif %}
                                        </div>
                                        {% if rec.description %}
                                            <div class="frame47-profile-recommendation-desc">{{ rec.description[:80] }}{% if rec.description|length > 80 %}...{% endif %}</div>
                                        {% endif %}
                                        <div class="frame33-profile-category-actions">
                                            <a href="{{ url_for('view_recommendation', profile_slug=profile.slug, category_slug=category.slug, rec_id=rec.id) }}" class="frame33-profile-category-action-btn">
                                                <i class="fas fa-info-circle"></i> Details
                                            </a>
                                            {% if rec.url %}
                                                <a href="{{ rec.url }}" target="_blank" rel="noopener" class="frame33-profile-category-action-btn">
                                                    <i class="fas fa-external-link-alt"></i> Visit
                                                </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        {% if category.recommendations|length > 3 %}
                            <div>
                                <a href="{{ url_for('view_category', profile_slug=profile.slug, category_slug=category.slug) }}" class="frame33-profile-category-action-btn">
                                    +{{ category.recommendations|length - 3 }} more
                                </a>
                            </div>
                        {% endif %}
                    {% else %}
                        <div class="frame33-profile-category-desc" style="font-style: italic;">No recommendations yet.</div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        </div>    
    {% else %}
        <div class="frame47-profile-section">
            <div style="font-size: 3rem; margin-bottom: 1rem;">
                <i class="fas fa-folder-open"></i>
            </div>
            <h2 class="frame47-profile-section-title">No Categories Yet</h2>
            <div class="frame47-profile-section-content">
                This profile doesn't have any recommendation categories yet.<br>
                <span style="opacity: 0.7;">Check back later for curated recommendations!</span>
            </div>
        </div>
    {% endif %}
</div>

    <!-- Frame 48 Share Section -->
<div class="frame48-share-profile"
     style="
        display: flex;
        flex-direction: row;
        align-items: center;
        padding: 20px 20px 30px;
        gap: 20px;
        width: 100%;
        max-width: 1200px;
        min-width: 0;
        height: auto;
        background: #ECBED9;
        border: 4px solid #000000;
        box-shadow: 7px 8px 0px #000000;
        border-radius: 26px;
        margin: 40px auto 0 auto;
        box-sizing: border-box;
        flex-wrap: wrap;
     ">
    <div class="frame48-share-header"
         style="
            font-size: 1.4rem;
            font-weight: 900;
            color: #2C2C2E;
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            word-break: break-word;
            text-align: left;
            width: 100%;
            min-width: 0;
            box-sizing: border-box;
         ">
        <span class="frame48-share-title"
              style="
                font-size: 1.4rem;
                font-weight: 900;
                color: #2C2C2E;
                display: flex;
                align-items: center;
                gap: 10px;
                flex-wrap: wrap;
                word-break: break-word;
                text-align: left;
                width: 100%;
                min-width: 0;
                box-sizing: border-box;
              ">
            Share this profile with others
        </span>
    </div>
    <div class="frame48-share-content"
         style="
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: flex-start;
            justify-content: center;
         ">
        <div class="frame48-share-link-row"
             style="
                display: flex;
                align-items: center;
                gap: 12px;
                width: 100%;
             ">
            <input type="text"
                   class="frame48-share-link"
                   value="{{ url_for('view_profile', slug=profile.slug, _external=True) }}"
                   readonly
                   onclick="this.select()"
                   style="
                        flex: 1;
                        border-radius: 12px;
                        border: 2px solid #000;
                        padding: 10px 18px;
                        font-size: 1rem;
                        font-family: monospace;
                        background: #fff;
                        color: #2C2C2E;
                        text-align: center;
                        outline: none;
                        min-width: 0;
                        box-sizing: border-box;
                   ">
            <a href="javascript:void(0);"
               class="frame48-btn-copy"
               onclick="copyToClipboard(this)"
               style="
                    background: #fff;
                    color: #2C2C2E;
                    font-size: 1rem;
                    font-weight: 700;
                    padding: 10px 24px;
                    border: 2px solid #000;
                    border-radius: 110px;
                    display: inline-flex;
                    align-items: center;
                    gap: 8px;
                    cursor: pointer;
                    transition: background 0.2s;
                    text-decoration: none;
                    outline: none;
                    box-shadow: none;
                    appearance: none;
                    -webkit-appearance: none;
                    box-sizing: border-box;
                    min-width: 0;
               ">
                <img src="{{ url_for('static', filename='svg/copy-alt.svg') }}"
                     alt="Copy"
                     class="frame48-copy-svg"
                     style="width: 18px; height: 18px; vertical-align: middle;">
                Copy Link
            </a>
        </div>
    </div>
    <style>
    @media (max-width: 600px) {
        .frame48-share-profile {
            flex-direction: column !important;
            align-items: stretch !important;
            padding: 12px 4px 16px !important;
            gap: 10px !important;
            max-width: 100vw !important;
            border-radius: 14px !important;
            box-shadow: 3px 4px 0 #000 !important;
        }
        .frame48-share-header,
        .frame48-share-content,
        .frame48-share-link-row {
            width: 100% !important;
            min-width: 0 !important;
            flex-direction: column !important;
            gap: 8px !important;
        }
        .frame48-share-title {
            font-size: 1.1rem !important;
            gap: 6px !important;
            text-align: center !important;
            justify-content: center !important;
            padding: 0 4px !important;
        }
        .frame48-share-link {
            font-size: 0.95rem !important;
            padding: 8px 8px !important;
            border-radius: 7px !important;
            width: 100% !important;
            min-width: 0 !important;
            box-sizing: border-box !important;
        }
        .frame48-btn-copy {
            width: 100% !important;
            font-size: 0.95rem !important;
            padding: 10px 0 !important;
            border-radius: 40px !important;
            justify-content: center !important;
        }
    }
    </style>
</div>
</div>

</div>
{% endblock %}

{% block scripts %}
<script>
function copyToClipboard(btn) {
    const input = btn.parentElement.querySelector('.frame48-share-link');
    input.select();
    document.execCommand('copy');
    btn.classList.add('copied');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<img src="{{ url_for('static', filename='svg/copy-check.svg') }}" alt="Copied" class="frame48-copy-svg"> Copied!';
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.classList.remove('copied');
    }, 2000);
}
</script>
{% endblock %}